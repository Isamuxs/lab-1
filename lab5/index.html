<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Каталог — Single Page App</title>
  <!-- Bootstrap CSS for styling (allowed) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding-top: 70px; }
    .card-img-top{ width:100%; height:160px; object-fit:cover; }
    nav .nav-link { cursor: pointer; }
    .notes { font-style: italic; color: #666; }
  </style>
</head>
<body>
  <!-- Навігація -->
  <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand" id="home-link">Додому</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="nav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" id="catalog-link">Каталог</a></li>
          <li class="nav-item"><a class="nav-link" id="specials-link">Specials</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container" id="app">
    <!-- Головна сторінка: тут будуть посилання на категорії -->
    <section id="home" class="mb-4">
      <h1>Вітання!</h1>
      <p>Натисніть «Каталог», щоб завантажити категорії з JSON або клікніть на назву категорії, щоб переглянути товари.</p>
      <div id="categories-list" class="list-group"></div>
    </section>

    <!-- Розділ каталогу (динамічний) -->
    <section id="catalog" class="d-none">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <h2 id="catalog-title"></h2>
          <div id="catalog-notes" class="notes"></div>
        </div>
        <div>
          <button id="back-home" class="btn btn-secondary btn-sm">Назад</button>
        </div>
      </div>
      <div id="items-row" class="row g-3"></div>
    </section>

    <!-- Повідомлення про помилки або статус -->
    <div id="status" class="mt-3 text-muted"></div>
  </main>

  <script>
    // Глобальні змінні
    const categoriesUrl = 'categories.json'; // файл зі списком категорій

    // DOM
    const homeSection = document.getElementById('home');
    const catalogSection = document.getElementById('catalog');
    const categoriesList = document.getElementById('categories-list');
    const catalogLink = document.getElementById('catalog-link');
    const homeLink = document.getElementById('home-link');
    const specialsLink = document.getElementById('specials-link');
    const catalogTitle = document.getElementById('catalog-title');
    const catalogNotes = document.getElementById('catalog-notes');
    const itemsRow = document.getElementById('items-row');
    const status = document.getElementById('status');
    const backHomeBtn = document.getElementById('back-home');

    let categories = []; // масив категорій завантажених із categories.json

    // Допоміжні функції для UI
    function showStatus(msg, isError = false){
      status.textContent = msg;
      status.style.color = isError ? 'crimson' : '#6c757d';
    }

    function showHome(){
      catalogSection.classList.add('d-none');
      homeSection.classList.remove('d-none');
      showStatus('');
    }

    function showCatalog(){
      homeSection.classList.add('d-none');
      catalogSection.classList.remove('d-none');
    }

    // Завантажити список категорій із серверу (categories.json)
    async function loadCategories(){
      try{
        showStatus('Завантаження категорій...');
        const res = await fetch(categoriesUrl);
        if(!res.ok) throw new Error('Не вдалося завантажити ' + categoriesUrl + ' — ' + res.status);
        categories = await res.json();

        // Оновити список лінків на головній сторінці
        categoriesList.innerHTML = '';
        categories.forEach(cat => {
          const a = document.createElement('a');
          a.className = 'list-group-item list-group-item-action';
          a.textContent = cat.name;
          a.dataset.shortname = cat.shortname;
          a.addEventListener('click', () => openCategory(cat.shortname));
          categoriesList.appendChild(a);
        });

        // Додати лінку Specials (виконуватиме випадковий вибір категорії)
        const specialsNote = document.createElement('div');
        specialsNote.className = 'mt-3 small text-muted';
        specialsNote.innerHTML = 'Після списку категорій — <strong>Specials</strong> (случайна категорія).';
        categoriesList.appendChild(specialsNote);

        showStatus('Категорії завантажено. Клікніть категорію або «Каталог».');
      }catch(err){
        console.error(err);
        showStatus('Помилка: ' + err.message, true);
      }
    }

    // Відкрити категорію: підвантажити відповідний JSON-файл (shortname.json)
    async function openCategory(shortname){
      try{
        showStatus('Завантаження категорії ' + shortname + '...');
        const cat = categories.find(c => c.shortname === shortname);
        const filename = shortname + '.json';
        const res = await fetch(filename);
        if(!res.ok) throw new Error('Не вдалося завантажити ' + filename + ' — ' + res.status);
        const data = await res.json();

        // Якщо в самому файлі немає title/notes, використаємо дані з categories.json
        const title = data.title || (cat ? cat.name : shortname);
        const notes = data.notes || (cat ? cat.notes : '');

        catalogTitle.textContent = title;
        catalogNotes.textContent = notes || '';

        // Очистити і додати товари
        itemsRow.innerHTML = '';
        data.items.forEach(item => {
          const col = document.createElement('div');
          col.className = 'col-12 col-sm-6 col-md-4 col-lg-3';

          col.innerHTML = `
            <div class="card h-100">
              <img src="${item.image || 'https://place-hold.it/300x200'}" class="card-img-top" alt="${item.name}">
              <div class="card-body d-flex flex-column">
                <h5 class="card-title">${item.name}</h5>
                <p class="card-text small">${item.description}</p>
                <div class="mt-auto fw-semibold">${item.price}</div>
              </div>
            </div>
          `;

          itemsRow.appendChild(col);
        });

        showCatalog();
        showStatus('Категорію завантажено.');
      }catch(err){
        console.error(err);
        showStatus('Помилка: ' + err.message, true);
      }
    }

    // Specials: вибір випадкової категорії
    function openRandomCategory(){
      if(!categories || categories.length === 0){
        showStatus('Спочатку завантажте категорії (клікніть «Каталог»).', true);
        return;
      }
      const idx = Math.floor(Math.random() * categories.length);
      const shortname = categories[idx].shortname;
      openCategory(shortname);
    }

    // Події на кнопках
    catalogLink.addEventListener('click', () => {
      // Навантажити категорії та показати їх (без перезавантаження сторінки)
      loadCategories();
    });

    homeLink.addEventListener('click', () => {
      // перехід на саму сторінку (фактично — показ домашньої секції)
      showHome();
    });

    specialsLink.addEventListener('click', () => openRandomCategory());
    backHomeBtn.addEventListener('click', () => showHome());

    // Автоматично спробуємо завантажити categories.json при першому завантаженні
    document.addEventListener('DOMContentLoaded', () => {
      loadCategories();
    });
  </script>

  <!-- Bootstrap JS (не обов'язково, але для мобільного меню) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!--
    SAMPLES (ЗБЕРЕЖІТЬ ЦІ JSON-ФАЙЛИ РАЗОМ З index.html):

    1) categories.json
    [
      { "id": 1, "name": "Електроніка", "shortname": "electronics", "notes": "Приклади товарів: навушники, колонки." },
      { "id": 2, "name": "Книги", "shortname": "books", "notes": "Lorem ipsum dolor sit amet." },
      { "id": 3, "name": "Кава та аксесуари", "shortname": "coffee", "notes": "Короткі примітки про категорію." }
    ]

    2) electronics.json
    {
      "title": "Електроніка — наш вибір",
      "notes": "Гаджети та аксесуари.",
      "items": [
        { "id": 1, "name": "Навушники Pro", "shortname": "hp1", "description": "Безпровідні навушники з шумозаглушенням.", "price": "€79.99", "image": "https://place-hold.it/300x200?text=Headphones" },
        { "id": 2, "name": "Портативна колонка", "shortname": "sp1", "description": "Компактна колонка для прогулянок.", "price": "€49.00", "image": "https://place-hold.it/300x200?text=Speaker" },
        { "id": 3, "name": "Фітнес-браслет", "shortname": "fb1", "description": "Монітор пульсу та кроків.", "price": "€29.50", "image": "https://place-hold.it/300x200?text=Band" },
        { "id": 4, "name": "Павербанк 10000mAh", "shortname": "pb1", "description": "Швидка зарядка для ваших пристроїв.", "price": "€24.00", "image": "https://place-hold.it/300x200?text=Powerbank" }
      ]
    }

    3) books.json
    {
      "title": "Книги",
      "notes": "Підбірка книг різних жанрів.",
      "items": [
        { "id": 1, "name": "Роман: Пригоди", "shortname": "b1", "description": "Опис роману Lorem ipsum...", "price": "UAH 199", "image": "https://place-hold.it/200x200?text=Book+1" },
        { "id": 2, "name": "Підручник C++", "shortname": "b2", "description": "Короткий опис підручника.", "price": "UAH 350", "image": "https://place-hold.it/200x200?text=C%2B%2B" },
        { "id": 3, "name": "Книга з UX", "shortname": "b3", "description": "Про дизайн інтерфейсів.", "price": "UAH 240", "image": "https://place-hold.it/200x200?text=UX" },
        { "id": 4, "name": "Комікс", "shortname": "b4", "description": "Легка пригодницька історія.", "price": "UAH 120", "image": "https://place-hold.it/200x200?text=Comic" }
      ]
    }

    4) coffee.json
    {
      "title": "Кава та аксесуари",
      "notes": "Кава, чашки, френч-преси.",
      "items": [
        { "id": 1, "name": "Зернова кава 250г", "shortname": "c1", "description": "Ароматна кава середнього обсмаження.", "price": "UAH 180", "image": "https://place-hold.it/200x200?text=Coffee" },
        { "id": 2, "name": "Френч-прес", "shortname": "c2", "description": "Класичний френч-прес на 1 л.", "price": "UAH 450", "image": "https://place-hold.it/200x200?text=Press" },
        { "id": 3, "name": "Подарунковий набір", "shortname": "c3", "description": "Набір для шанувальників кави.", "price": "UAH 650", "image": "https://place-hold.it/200x200?text=Set" },
        { "id": 4, "name": "Млинок для кави", "shortname": "c4", "description": "Електричний млинок ручного типу.", "price": "UAH 899", "image": "https://place-hold.it/200x200?text=Grinder" }
      ]
    }

    ПРИМІТКИ:
    - Збережіть index.html і згадані JSON файли (categories.json, electronics.json, books.json, coffee.json)
      в одну папку.
    - Для тестування відкрийте папку через локальний сервер (наприклад: "python -m http.server 8000")
      і перейдіть на http://localhost:8000/index.html. Це потрібно, бо fetch не працює з протоколом file://

    Цей односторінковий застосунок не використовує React/Angular/Vue — лише ванільний JS + Bootstrap.
  -->
</body>
</html>
